# Chapter 8 File system

文件系统用于管理和存储数据，支持在用户和应用程序之间分享数据。

文件系统通常会碰到以下几种挑战：

* 需要一种存储在磁盘上的数据结构来描述文件目录树，记录磁盘块与文件内容的关系，以及磁盘空闲块的位置。
* 文件系统必须支持崩溃恢复，即当因电源等问题出现崩溃后，文件系统能够在重启后正常工作。这其中的挑战在于，崩溃可能发生在一系列更新中间，导致文件系统的数据结构不完整或不合法。
* 多进程并发读写的问题。
* 由于读写磁盘总是要比读写内存慢，所以文件系统一般需要在内存中维护一个活动块的缓存。

## Overview
xv6 的文件系统实现由以下 7 层组成。

![](_v_images/20220503164838786_3172.png)

其中，每层的功能分工如下：Disk 层在 virtio hard drive 上读写块数据