# 第4章 处理器

处理器的实现方式决定了时钟周期长度和 CPI 。

## RISC-V 核心子集的基本实现
考虑一个 RISC-V 的核心子集，包括：存储器访存指令（ld  和 sd），算术逻辑指令（add,sub and, or），条件分支指令（beq）。  
RISC-V 指令系统的简单性和规整性使不同类的指令具有类似的执行过程，从而简化了实现。

![RISC-V 实现的抽象视图](_v_images/20220915185926257_23358.png)

注意到图中多个数据指向同一个单元的情况，这是由于不同的指令类型可能导致不同的数据选择（而不是将这些多个数据混合）。通常需要使用多选器（数据选择器）来从多个数据源选择一个合适的发送给目标单元。  
同样也需要一些控制线来设置 ALU 的运算类型。  
增加了上述选择器和控制线的抽象图如下

![RISC-V 抽象视图](_v_images/20220915190626330_19416.png)

## 数据通路单元
数据通路单元：用来操作或保存处理器中数据的单元（包括指令存储器，数据存储器，寄存器堆，ALU 和加法器）。  
在该精简 RISC-V 指令集架构中，需要考虑以下数据通路单元：

* 存储单元：存储程序指令，并根据给定地址提供指令。  
* 程序计数器 PC：保存当前指令的地址。  
* 加法器：用于增加 PC 的值以获得下一条指令的地址。  
* 寄存器堆：注意到 RISC-V 规范，需要 3 个寄存器号输入（2 个用于 read ，1 个用于 write），2 个寄存器数据输出和 1 个寄存器数据输入。寄存器号输入为 5 位宽（32个寄存器），而数据的输入和输出总线为 64 位宽。另外还需要一个附加的写信号来明确写控制有效。注意到写寄存器堆是边缘触发的，所以允许在同一个时钟周期内读写同一个寄存器（读操作立即读出原本存放的内容，而写操作的内容直到下一个周期才可读）。  
* ALU：读取两个 64 位输入并产生一个 64 位输出，另外还有一个附加的 1 位输出指示其结果是否为 0 。ALU 操作由 4 位的 ALU 控制信号控制。
* 